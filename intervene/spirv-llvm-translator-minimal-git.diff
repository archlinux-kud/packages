diff --git a/PKGBUILD b/PKGBUILD
index 2b215b1..b431d9d 100644
--- a/PKGBUILD
+++ b/PKGBUILD
@@ -3,15 +3,16 @@
 _srcname=SPIRV-LLVM-Translator
 pkgname=spirv-llvm-translator-minimal-git
 pkgdesc="Tool and a library for bi-directional translation between SPIR-V and LLVM IR, trunk version"
-epoch=1
-pkgver=r1817.066514b
-pkgrel=2
+pkgver=18.0.0.r1921.gaeeaf6c3
+pkgrel=1
 arch=('x86_64')
 url="https://github.com/KhronosGroup/SPIRV-LLVM-Translator"
 license=('custom:Apache 2.0 with LLVM Exception')
-makedepends=(llvm-minimal-git git cmake spirv-headers-git spirv-tools-git)
-checkdepends=(python python-setuptools clang-minimal-git)
-depends=(llvm-libs-minimal-git spirv-tools-git gcc-libs glibc)
+groups=('mesa-minimal')
+# edit makedepends array so we build with our llvm-git
+makedepends=(llvm-git git cmake spirv-headers-git spirv-tools-git)
+checkdepends=(python python-setuptools)
+depends=(spirv-tools-git gcc-libs glibc)
 provides=(spirv-llvm-translator)
 conflicts=(spirv-llvm-translator)
 source=("git+$url.git"
@@ -21,9 +22,20 @@ md5sums=('SKIP')
 sha512sums=('SKIP')
 
 
+prepare() {
+    cd $_srcname
+    # Declaration was changed with SPIRV-Headers@d5acd42cb7cdaa5d0f2c5f739208eeeed395f491
+    grep -R LongConstantCompositeINTEL . | cut -d: -f1 | uniq | while read -r file; do
+        sed 's/LongConstantCompositeINTEL/LongCompositesINTEL/g' -i "$file"
+    done
+}
+
 pkgver() {
     cd $_srcname
-    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short=7 HEAD)"
+    printf "%s.r%s.g%s" \
+        "$(grep -o 'BASE_LLVM_VERSION [^ \)]*' CMakeLists.txt | cut -d' ' -f2)" \
+        "$(git rev-list --count HEAD)" \
+        "$(git rev-parse --short HEAD)"
 }
 
 build() {
@@ -32,13 +44,19 @@ build() {
         -B _build \
         -S "$srcdir"/$_srcname  \
         -G "Unix Makefiles" \
+        -D CMAKE_AR=/usr/bin/llvm-ar \
         -D CMAKE_BUILD_TYPE=Release \
+        -D CMAKE_C_COMPILER=clang \
+        -D CMAKE_CXX_COMPILER=clang++ \
         -D CMAKE_INSTALL_PREFIX=/usr \
         -D CMAKE_POSITION_INDEPENDENT_CODE=ON \
+        -D CMAKE_RANLIB=/usr/bin/llvm-ranlib \
         -D CMAKE_SKIP_RPATH=ON \
+        -D LLVM_ENABLE_LTO=Thin \
         -D LLVM_EXTERNAL_LIT=/usr/bin/lit \
         -D LLVM_EXTERNAL_SPIRV_HEADERS_SOURCE_DIR=/usr/include/spirv/ \
         -D LLVM_SPIRV_INCLUDE_TESTS=ON \
+        -D LLVM_USE_LINKER=lld \
         -D BUILD_SHARED_LIBS=ON \
         -Wno-dev
 
@@ -50,6 +68,8 @@ check() {
 }
 
 package() {
+    # move llvm-libs-minimal-git dependency here
+    depends+=('llvm-libs-minimal-git')
 
     make -C _build DESTDIR="${pkgdir}" install
     install -Dm755 _build/tools/llvm-spirv/llvm-spirv -t "$pkgdir"/usr/bin
